file-path:: ../assets/Linux_4_文件操作_1656378195377_0.pdf
file:: [Linux_4_文件操作_1656378195377_0.pdf](../assets/Linux_4_文件操作_1656378195377_0.pdf)
title:: hls__Linux_4_文件操作_1656378195377_0

- ab和ab+为追加模式，在此两种模式下，在一开**始的时候读取文件内容是从文件起始处开始读取的，而无论文件读写点定位到何处，在写数据时都将是在文件末尾添加（写完以后读写点就移动到文件末尾了）**，所以比较适合于多进程写同一个文件的情况下保证数据的完整性
  ls-type:: annotation
  hl-page:: 1
  id:: 62ba537d-3c12-438b-9fb0-fc9f1827ad3d
- 惯用法：getcwd(NULL, 0);
  ls-type:: annotation
  hl-page:: 3
  id:: 62ba53b2-0668-4d8d-88c9-26cd085b8995
- 结构体stat的定义
  ls-type:: annotation
  hl-page:: 7
  id:: 62ba53ef-3620-471b-8156-526b2fea4a1e
- 上一节所讨论的文件都是使用FILE类型来管理，根据FILE类型的结构可知它的本质是一个缓冲区。与FILE类型相关的文件操作（比如fopen，fread等等）称为带缓冲的IO，它们是ISO C的组成部分
  ls-type:: annotation
  hl-page:: 8
  id:: 62ba5401-629e-4b9b-89eb-d08fe1191e8d
- POSIX标准支持另一类不带缓冲区的IO。在这里，文件是使用文件描述符来描述。文件描述符是一个非负整数。**从原理上来说，进程地址空间的内核部分里面会维护一个已经打开的文件的数组**，这个数组用来管理所有已经打开的文件（打开的文件存储在进程地址空间的内核区中，称为文件对象），**而文件描述符就是这个数组的索引。**因此，文件描述符可以实现进程和打开文件之间的交互
  hl-page:: 8
  ls-type:: annotation
  id:: 62ba5429-1466-49f5-8d81-2592eebb3612
	- 文件描述符就是一个数组索引！
- 使用完文件以后，要记得使用close来关闭文件。一旦调用close，则该进程对文件所加的锁全都被释放，并且使文件的打开引用计数减1，只有文件的打开引用计数变为0以后，文件才会被真正的关闭。
  ls-type:: annotation
  hl-page:: 9
  id:: 62ba550b-942f-40c3-be4f-a4259af401c7
- 对于read和write函数，出错返回-1，读取完了之后，返回0，其他情况返回读写的个数。
  ls-type:: annotation
  hl-page:: 9
  id:: 62ba5551-7b91-47fb-9ce5-ab4c810d71ab
- read的效率问题：使用不带缓冲IO的时候，CPU需要陷入内核态来处理文件读取。如果频繁地使用read来读取少量数据，数据的读取效率会比较低
  ls-type:: annotation
  hl-page:: 10
  id:: 62ba55f0-e9fd-441e-a752-48bd1530339b
- 使用mmap接口可以实现直接将一个磁盘文件映射到存储空间的一个缓冲区上面，无需使用read和write进行IO
  ls-type:: annotation
  hl-page:: 11
  id:: 62ba56cd-0188-4c53-b9d5-dcb2688ac434
- （有名）管道文件是用来数据通信的一种文件，它是半双工通信，它在ls -l命令中显示为p，它不能存储数据
  ls-type:: annotation
  hl-page:: 17
  id:: 62bba586-0193-4028-a9a1-3392306a6cd9
	- 管道的读写
		- shell命令读写
		- C语言使用open来打开管道读写，就和正常的文件读写一样了，只是打开时候是只读和只写
- 禁止使用vim来打开管道文件
  ls-type:: annotation
  hl-page:: 18
  id:: 62bba613-373d-461a-97bd-da85e28b999c
- 阻塞：在目前的模式下，read函数如果不能从文件中读取内容，就将进程的状态切换到阻塞状态，不再继续执行
  ls-type:: annotation
  hl-page:: 18
  id:: 62bba679-ef62-41c9-9dd4-c5fd91cc3bd6
	- 管道是阻塞的IO，所以read会阻塞
- 因为管道文件是半双工通信，为了实现全双工通信，可以使用2个管道文件。这样就可以实现即时聊天
  ls-type:: annotation
  hl-page:: 18
  id:: 62bba68e-e7b1-4034-8227-e3456b708057